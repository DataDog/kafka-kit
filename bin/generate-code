#!/bin/bash

set -euo pipefail

BIN="$(dirname "$(readlink -f "$0")")"
ROOT="$(dirname "${BIN}")"

docker build -t code-generator -f Dockerfile.generate .

docker run code-generator \
  bash -c "cat /go/src/github.com/DataDog/kafka-kit/registry/protos/registry.pb.go" \
  > "${ROOT}/registry/protos/registry.pb.go"

docker run code-generator \
  bash -c "cat /go/src/github.com/DataDog/kafka-kit/registry/protos/registry.pb.gw.go" \
  > "${ROOT}/registry/protos/registry.pb.gw.go"
